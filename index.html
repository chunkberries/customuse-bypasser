<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Customuse Bypasser Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    --primary: #6C63FF;
    --primary-hover: #5a52d5;
    --accent: #00D2FF;
    --text-main: #2d3748;
    --text-sub: #718096;
    --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    --card-bg: rgba(255, 255, 255, 0.85);
    --nav-bg: rgba(255, 255, 255, 0.9);
    --input-bg: #f7fafc;
    --border-color: #e2e8f0;
    --shadow: 0 10px 30px rgba(0,0,0,0.1);
    --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  body.dark-mode {
    --text-main: #f7fafc;
    --text-sub: #a0aec0;
    --bg-gradient: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    --card-bg: rgba(26, 32, 44, 0.9);
    --nav-bg: rgba(26, 32, 44, 0.95);
    --input-bg: #2d3748;
    --border-color: #4a5568;
    --shadow: 0 10px 30px rgba(0,0,0,0.4);
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg-gradient);
    min-height: 100vh;
    margin: 0;
    color: var(--text-main);
    overflow-x: hidden;
    transition: background 0.5s ease;
  }

  nav {
    position: fixed; top: 0; left: 0; width: 100%;
    padding: 15px 40px;
    background: var(--nav-bg);
    backdrop-filter: blur(10px);
    display: flex; justify-content: space-between; align-items: center;
    z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }

  .logo { font-weight: 700; font-size: 1.4em; color: var(--primary); display: flex; align-items: center; gap: 10px; }
  .nav-links { display: flex; gap: 20px; align-items: center; }

  .nav-btn {
    background: none; border: none; font-family: inherit; font-weight: 600;
    color: var(--text-sub); cursor: pointer; transition: var(--transition);
    font-size: 1em; position: relative;
  }
  .nav-btn.active, .nav-btn:hover { color: var(--primary); }
  .nav-btn.active::after {
    content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px;
    background: var(--primary); border-radius: 2px;
  }

  .theme-toggle {
    background: var(--input-bg); border: 1px solid var(--border-color);
    padding: 8px 12px; border-radius: 20px; cursor: pointer;
    color: var(--text-main); display: flex; align-items: center; gap: 8px;
    transition: var(--transition);
  }

  /* Page Layout */
  .page-container {
    padding-top: 100px; padding-bottom: 50px;
    width: 100%; max-width: 900px; margin: 0 auto;
    display: none; animation: fadeIn 0.5s ease-out;
  }
  .page-container.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .card {
    background: var(--card-bg); padding: 40px; border-radius: 24px;
    box-shadow: var(--shadow); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
  }

  h1 { text-align: center; margin-bottom: 10px; }
  p.subtitle { text-align: center; color: var(--text-sub); margin-bottom: 30px; }

  /* --- ANIMATED INPUT --- */
  .input-group { position: relative; margin-bottom: 25px; }
  label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-sub); }
  
  input[type="text"] {
    width: 100%; padding: 16px 20px; font-size: 1em;
    background: var(--input-bg); border: 2px solid var(--border-color);
    border-radius: 12px; color: var(--text-main); 
    transition: all 0.3s ease;
    /* Prepare for float */
    transform: translateY(0);
  }

  /* The Floating Animation */
  @keyframes floatInput {
    0% { transform: translateY(0px); box-shadow: 0 5px 15px rgba(108, 99, 255, 0.1); }
    50% { transform: translateY(-6px); box-shadow: 0 15px 25px rgba(108, 99, 255, 0.2); }
    100% { transform: translateY(0px); box-shadow: 0 5px 15px rgba(108, 99, 255, 0.1); }
  }

  input[type="text"]:focus {
    border-color: var(--primary);
    outline: none;
    background: #fff;
    /* Trigger the float */
    animation: floatInput 3s ease-in-out infinite;
  }
  
  /* Dark mode specific focus bg */
  body.dark-mode input[type="text"]:focus {
      background: #2d3748;
  }

  /* --- ANIMATED BUTTON --- */
  .btn-primary {
    width: 100%; padding: 16px; font-size: 1.1em; font-weight: 600; color: #fff;
    background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
    border: none; border-radius: 12px; cursor: pointer;
    transition: var(--transition); 
    box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
    position: relative;
    overflow: hidden;
  }
  
  .btn-primary:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 8px 20px rgba(108, 99, 255, 0.4); 
  }
  
  /* Jelly click effect */
  .btn-primary:active {
    transform: scale(0.95);
  }

  .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; filter: grayscale(1); }

  /* --- LIQUID PROGRESS BAR --- */
  #progressContainer {
    width: 100%; height: 12px; /* Slightly thicker */
    background: var(--input-bg);
    border-radius: 10px; margin-top: 20px; overflow: hidden; display: none;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
  }

  @keyframes barberpole {
    0% { background-position: 0 0; }
    100% { background-position: 50px 50px; }
  }

  #progressBar {
    height: 100%; width: 0%;
    /* Striped Gradient */
    background-image: linear-gradient(
      45deg, 
      var(--primary) 25%, 
      var(--accent) 25%, 
      var(--accent) 50%, 
      var(--primary) 50%, 
      var(--primary) 75%, 
      var(--accent) 75%, 
      var(--accent) 100%
    );
    background-size: 50px 50px;
    /* The flow animation */
    animation: barberpole 1s linear infinite;
    /* Smooth width transition */
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 10px rgba(108, 99, 255, 0.5);
    border-radius: 10px;
  }

  .results-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px; margin-top: 40px; opacity: 0; transform: translateY(20px);
    transition: var(--transition); pointer-events: none;
  }
  .results-grid.visible { opacity: 1; transform: translateY(0); pointer-events: all; }

  .result-card {
    background: var(--nav-bg); padding: 20px; border-radius: 16px;
    text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    border: 1px solid var(--border-color);
  }
  canvas { width: 100%; height: auto; border-radius: 8px; background: var(--input-bg); margin-bottom: 15px; }

  .download-btn {
    display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px;
    border: 2px solid var(--primary); color: var(--primary); text-decoration: none;
    font-weight: 600; border-radius: 8px; transition: var(--transition);
  }
  .download-btn:hover { background: var(--primary); color: white; }

  .instruction-step {
    display: flex; align-items: flex-start; gap: 20px; margin-bottom: 30px;
    background: var(--nav-bg); padding: 20px; border-radius: 16px; border: 1px solid var(--border-color);
  }
  .step-number {
    background: var(--primary); color: white; width: 35px; height: 35px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-weight: 700; flex-shrink: 0;
  }
  
  .tour-btn {
    background: var(--accent); color: #fff; padding: 15px 30px; border: none;
    border-radius: 50px; font-size: 1.1em; font-weight: 700; cursor: pointer;
    display: block; margin: 40px auto; box-shadow: 0 5px 15px rgba(0, 210, 255, 0.4);
    transition: var(--transition);
  }
  .tour-btn:hover { transform: scale(1.05); }

  .history-section { margin-top: 30px; border-top: 1px solid var(--border-color); padding-top: 20px; }
  .history-item {
    display: flex; justify-content: space-between; padding: 10px;
    background: var(--input-bg); margin-bottom: 8px; border-radius: 8px; cursor: pointer;
    transition: var(--transition); color: var(--text-sub); font-size: 0.9em;
  }
  .history-item:hover { background: var(--border-color); color: var(--text-main); }

  /* --- TUTORIAL OVERLAY STYLES --- */
  .tutorial-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 2000;
    display: none;
    transition: background 0.5s ease;
  }

  .tutorial-overlay.minimized-mode {
    background: rgba(0,0,0,0.0);
    pointer-events: none;
  }

  .tutorial-card {
    background: #fff;
    width: 90%; max-width: 600px;
    border-radius: 20px; overflow: hidden;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
    display: flex; flex-direction: column;
    pointer-events: auto;
  }

  .tutorial-card.minimized {
    top: 100px; left: auto; right: 20px;
    transform: translate(0, 0) scale(0.9);
    width: 320px; border: 2px solid var(--primary);
  }

  .tutorial-image {
    width: 100%; height: 300px; object-fit: cover; object-position: top;
    background: #f0f0f0; transition: height 0.4s ease, opacity 0.3s ease;
  }

  .tutorial-card.minimized .tutorial-image { height: 0; opacity: 0; }

  .tutorial-content { padding: 25px; text-align: center; }
  .tutorial-title { color: #333; font-weight: 700; font-size: 1.2em; margin-bottom: 10px; }
  .tutorial-desc { color: #666; margin-bottom: 20px; line-height: 1.5; font-size: 0.95em; }
  
  .tutorial-controls { display: flex; justify-content: space-between; margin-top: 10px; }
  .t-btn { padding: 8px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }
  .t-next { background: var(--primary); color: white; }
  .t-prev { background: #e2e8f0; color: #333; }
  .t-close { 
    position: absolute; top: 15px; right: 15px; z-index: 10;
    background: rgba(0,0,0,0.5); color: white; width: 30px; height: 30px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; 
  }

  .highlight-element {
    position: relative; z-index: 2001;
    border-color: #ff2a6d !important;
    box-shadow: 0 0 0 4px #ff2a6d, 0 0 40px rgba(255, 42, 109, 0.4) !important;
    animation: pulse 1.5s infinite;
    background-color: var(--input-bg); 
    transition: box-shadow 0.3s ease;
  }
  
  /* If highlighted element is floating, we pause it so user can click */
  .highlight-element:focus {
      animation: none !important;
      transform: none !important;
      box-shadow: 0 0 0 4px #ff2a6d, 0 0 40px rgba(255, 42, 109, 0.4) !important;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0px rgba(255, 42, 109, 0.7); }
    100% { box-shadow: 0 0 0 10px rgba(255, 42, 109, 0); }
  }

  @media(max-width: 600px) {
    .nav-links span { display: none; }
    nav { padding: 15px 20px; }
    .card { padding: 25px; }
    .tutorial-card.minimized { top: auto; bottom: 20px; right: 5%; left: 5%; width: 90%; }
  }
</style>
</head>
<body>

<nav>
  <div class="logo"> <i class="fa-solid fa-shirt"></i> Customuse BP </div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="switchPage('home')"> <i class="fa-solid fa-wand-magic-sparkles"></i> <span>Tool</span> </button>
    <button class="nav-btn" onclick="switchPage('instructions')"> <i class="fa-solid fa-book-open"></i> <span>Instructions</span> </button>
    <button class="theme-toggle" onclick="toggleTheme()"> <i class="fa-solid fa-moon"></i> </button>
  </div>
</nav>

<div id="home-page" class="page-container active">
  <div class="card">
    <h1>Asset Downloader</h1>
    <p class="subtitle">Enter a Design ID or URL to extract textures.</p>

    <div class="input-group">
      <label for="inputUrl">Design URL or ID</label>
      <input type="text" id="inputUrl" placeholder="https://customuse.com/d/..." autocomplete="off"/>
    </div>

    <button id="processBtn" class="btn-primary">Fetch Assets</button>
    
    <div id="progressContainer">
      <div id="progressBar"></div>
    </div>

    <div class="history-section">
      <label><i class="fa-solid fa-clock-rotate-left"></i> Recent Searches</label>
      <div id="historyList">
        <div style="text-align:center; font-size:0.8em; color:var(--text-sub); padding:10px;">No history yet</div>
      </div>
    </div>
  </div>

  <div id="resultsGrid" class="results-grid">
    <div class="result-card">
      <h3>Shirt Texture</h3>
      <canvas id="topCanvas" width="585" height="559"></canvas>
      <a id="downloadTop" class="download-btn" href="#" download="top.png" style="display:none;">Download PNG</a>
    </div>
    <div class="result-card">
      <h3>Pants Texture</h3>
      <canvas id="bottomCanvas" width="585" height="559"></canvas>
      <a id="downloadBottom" class="download-btn" href="#" download="bottom.png" style="display:none;">Download PNG</a>
    </div>
  </div>
</div>

<div id="instructions-page" class="page-container">
  <div class="card">
    <h1>How to Use</h1>
    <p class="subtitle">Follow these steps to get your design files.</p>

    <button class="tour-btn" onclick="startTutorial()"> <i class="fa-solid fa-play"></i> Start Interactive Tutorial </button>

    <div class="instruction-step">
      <div class="step-number">1</div>
      <div class="step-content"> <h3>Find Design</h3> <p>Go to Customuse. Select a design, click the three dots, select "Edit Info" or "Report".</p> </div>
    </div>
    <div class="instruction-step">
      <div class="step-number">2</div>
      <div class="step-content"> <h3>Copy Link</h3> <p>Copy the full URL from your browser address bar (e.g., <code>customuse.com/d/123...</code>).</p> </div>
    </div>
    <div class="instruction-step">
      <div class="step-number">3</div>
      <div class="step-content"> <h3>Paste & Download</h3> <p>Paste the link into the tool, click "Fetch Assets", and download your PNGs.</p> </div>
    </div>
  </div>
</div>

<div id="tutorialOverlay" class="tutorial-overlay">
    <div class="tutorial-card">
        <div class="t-close" onclick="endTutorial()">×</div>
        <img id="t-image" class="tutorial-image" src="" alt="Tutorial Step">
        <div class="tutorial-content">
            <h3 id="t-title" class="tutorial-title">Step Title</h3>
            <p id="t-desc" class="tutorial-desc">Description</p>
            <div class="tutorial-controls">
                <button class="t-btn t-prev" onclick="prevStep()">Previous</button>
                <button class="t-btn t-next" onclick="nextStep()">Next</button>
            </div>
        </div>
    </div>
</div>

<footer>
  <p style="text-align:center; color:var(--text-sub); margin-top:50px; font-size:0.9em;">
    Made with ❤️ by <a href="https://github.com/chunkberries" style="color:var(--primary); text-decoration:none;">chunkberries</a>
  </p>
</footer>

<script>
const state = {
    darkMode: localStorage.getItem('darkMode') === 'true',
    history: JSON.parse(localStorage.getItem('searchHistory')) || [],
    currentStep: 0
};

const tutorialSteps = [
    {
        title: "Select Options",
        desc: "Find a design, press the three dots (menu) in the corner.",
        img: "https://github.com/user-attachments/assets/0c1824b0-71ef-4d5d-9887-b821b7924b11",
        target: null
    },
    {
        title: "Edit Info / Report",
        desc: "Click 'Edit Info' or 'Report' to reveal the URL.",
        img: "https://github.com/user-attachments/assets/aadde301-64a3-4ae3-a3e8-83860c25b652",
        target: null
    },
    {
        title: "Copy the Link",
        desc: "Copy the full URL from the address bar.",
        img: "https://github.com/user-attachments/assets/496ccdd0-51ef-43a9-bdbb-6dc669c67fa3",
        target: null
    },
    {
        title: "Paste URL Here",
        desc: "I've moved out of the way! Paste the link in the highlighted box.",
        img: "", 
        target: "#inputUrl",
        switchTo: 'home'
    },
    {
        title: "Click Fetch",
        desc: "Click this button to generate your PNGs.",
        img: "",
        target: "#processBtn",
        switchTo: 'home'
    }
];

document.addEventListener('DOMContentLoaded', () => {
    if (state.darkMode) document.body.classList.add('dark-mode');
    updateHistoryUI();
});

function switchPage(pageName) {
    document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`${pageName}-page`).classList.add('active');
    const index = pageName === 'home' ? 0 : 1;
    document.querySelectorAll('.nav-btn')[index].classList.add('active');
}

function toggleTheme() {
    state.darkMode = !state.darkMode;
    document.body.classList.toggle('dark-mode', state.darkMode);
    localStorage.setItem('darkMode', state.darkMode);
}

// --- Tutorial Logic ---
function startTutorial() {
    state.currentStep = 0;
    document.getElementById('tutorialOverlay').style.display = 'block';
    setTimeout(() => renderStep(), 10);
}

function endTutorial() {
    document.getElementById('tutorialOverlay').style.display = 'none';
    removeHighlight();
}

function nextStep() {
    if (state.currentStep < tutorialSteps.length - 1) {
        state.currentStep++;
        renderStep();
    } else {
        endTutorial();
    }
}

function prevStep() {
    if (state.currentStep > 0) {
        state.currentStep--;
        renderStep();
    }
}

function renderStep() {
    const step = tutorialSteps[state.currentStep];
    const overlay = document.getElementById('tutorialOverlay');
    const card = document.querySelector('.tutorial-card');
    
    if (step.switchTo) switchPage(step.switchTo);

    document.getElementById('t-image').src = step.img;
    document.getElementById('t-title').textContent = step.title;
    document.getElementById('t-desc').textContent = step.desc;
    
    document.querySelector('.t-prev').style.visibility = state.currentStep === 0 ? 'hidden' : 'visible';
    document.querySelector('.t-next').textContent = state.currentStep === tutorialSteps.length - 1 ? 'Finish' : 'Next';

    removeHighlight();
    
    if (step.target) {
        const targetEl = document.querySelector(step.target);
        if (targetEl) {
            targetEl.classList.add('highlight-element');
            targetEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Minimize
            card.classList.add('minimized');
            overlay.classList.add('minimized-mode');
        }
    } else {
        card.classList.remove('minimized');
        overlay.classList.remove('minimized-mode');
    }
}

function removeHighlight() {
    document.querySelectorAll('.highlight-element').forEach(el => el.classList.remove('highlight-element'));
}

// --- Bypasser Logic ---
const inputField = document.getElementById('inputUrl');
const processButton = document.getElementById('processBtn');

async function fetchAndProcess() {
    let inputVal = inputField.value.trim();
    if (!inputVal) return alert('Please enter a URL or Design ID.');

    // Reset UI
    document.getElementById('resultsGrid').classList.remove('visible');
    processButton.disabled = true;
    processButton.innerHTML = 'Processing...';
    document.getElementById('progressContainer').style.display = 'block';
    
    // START SMOOTH ANIMATION:
    // We set it to 70% with a long transition time (2s). 
    // This makes it look like it's continuously loading.
    const bar = document.getElementById('progressBar');
    bar.style.transition = 'width 2s cubic-bezier(0.4, 0, 0.2, 1)';
    bar.style.width = '70%';

    try {
        let designId = extractDesignId(inputVal);
        if (!designId) throw new Error("Invalid ID");
        
        addToHistory(designId);

        const response = await fetch(`https://api.customuse.com/v1/designs/${designId}`);
        if (!response.ok) throw new Error("API Error");
        
        const textData = await response.text();

        // Data found! Snap to 90% quickly
        bar.style.transition = 'width 0.4s ease';
        bar.style.width = '90%';

        const topMatch = textData.match(/"top":\s*"([^"]+)"/);
        const bottomMatch = textData.match(/"bottom":\s*"([^"]+)"/);

        let found = false;
        if (topMatch) { await processImage(topMatch[1], 'topCanvas', 'downloadTop'); found = true; }
        if (bottomMatch) { await processImage(bottomMatch[1], 'bottomCanvas', 'downloadBottom'); found = true; }

        // DONE: Snap to 100%
        bar.style.width = '100%';
        
        if (found) {
            setTimeout(() => {
                document.getElementById('progressContainer').style.display = 'none';
                bar.style.width = '0%'; // Reset for next time
                document.getElementById('resultsGrid').classList.add('visible');
                document.getElementById('resultsGrid').scrollIntoView({behavior:'smooth'});
            }, 600); // Wait for the 100% animation to finish
        } else {
            alert("No assets found.");
        }

    } catch (e) {
        alert("Error: Check URL/ID.");
        document.getElementById('progressContainer').style.display = 'none';
        bar.style.width = '0%';
    } finally {
        processButton.disabled = false;
        processButton.innerHTML = 'Fetch Assets';
    }
}

function extractDesignId(val) {
    if(!val.includes('/') && !val.includes('.')) return val; 
    try {
        if(val.startsWith('customuse')) val = 'https://'+val;
        const u = new URL(val);
        if(u.pathname.includes('/d/')) return u.pathname.split('/d/')[1].split('/')[0];
        return u.searchParams.get('updateDesign') || u.searchParams.get('report');
    } catch(e){ return null; }
}

async function processImage(url, cvsId, lnkId) {
    const c = document.getElementById(cvsId);
    const ctx = c.getContext('2d');
    const img = new Image(); img.crossOrigin='Anonymous'; img.src=url;
    await new Promise((r,j)=>{ img.onload=r; img.onerror=j; });
    ctx.clearRect(0,0,c.width,c.height); ctx.drawImage(img,0,0,c.width,c.height);
    const lnk = document.getElementById(lnkId); lnk.href=c.toDataURL(); lnk.style.display='inline-flex';
}

function addToHistory(id) {
    state.history = state.history.filter(i=>i!==id);
    state.history.unshift(id);
    if(state.history.length>5) state.history.pop();
    localStorage.setItem('searchHistory', JSON.stringify(state.history));
    updateHistoryUI();
}

function updateHistoryUI() {
    const list = document.getElementById('historyList');
    if(!state.history.length) return;
    list.innerHTML='';
    state.history.forEach(id => {
        const d = document.createElement('div'); d.className='history-item';
        d.innerHTML=`<span>${id}</span> <i class="fa-solid fa-arrow-right"></i>`;
        d.onclick=()=>{ inputField.value=id; fetchAndProcess(); };
        list.appendChild(d);
    });
}

processButton.addEventListener('click', fetchAndProcess);
inputField.addEventListener('keydown', e => { if(e.key==='Enter'){e.preventDefault(); fetchAndProcess();} });
</script>
</body>
</html>
